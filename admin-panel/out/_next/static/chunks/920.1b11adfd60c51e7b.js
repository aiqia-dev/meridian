"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[920],{85920:function(e,t,n){n.r(t),n.d(t,{MapDrawer:function(){return N}});var l=n(57437),r=n(2265),i=n(39499),o=n(95931),s=n(96480),a=n(68906),c=n(9043),u=n(89202),d=n(69984),f=n(30194),w=n(21595),h=n(8367),g=n(70713),m=n(81316),x=n(30722),Z=n(28224);n(86037);var b=n(12381),j=n(40519),p=n(21047),y=n(95796),v=n(42208),k=n(87769),P=n(18930);function N(e){let{onGeometryChange:t,initialGeometry:n,existingObjects:N=[]}=e,S=(0,r.useRef)(null),[z,E]=(0,r.useState)(null),[C]=(0,r.useState)(()=>new c.Z),[F]=(0,r.useState)(()=>new c.Z),[D,I]=(0,r.useState)(null),[L,G]=(0,r.useState)(null),[_,V]=(0,r.useState)(!0),[H,M]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!S.current)return;let e=new a.Z({source:C,style:new f.ZP({fill:new w.Z({color:"rgba(59, 130, 246, 0.2)"}),stroke:new h.Z({color:"#3b82f6",width:2}),image:new g.Z({radius:7,fill:new w.Z({color:"#3b82f6"}),stroke:new h.Z({color:"#ffffff",width:2})})}),zIndex:10}),t=new a.Z({source:F,style:e=>{let t=e.get("objectId")||"";return new f.ZP({fill:new w.Z({color:"rgba(156, 163, 175, 0.2)"}),stroke:new h.Z({color:"#6b7280",width:1.5,lineDash:[4,4]}),image:new g.Z({radius:5,fill:new w.Z({color:"#6b7280"}),stroke:new h.Z({color:"#ffffff",width:1})}),text:new m.Z({text:t,font:"11px sans-serif",fill:new w.Z({color:"#374151"}),stroke:new h.Z({color:"#ffffff",width:2}),offsetY:-15})})},zIndex:5});M(t);let l=new i.Z({target:S.current,layers:[new s.Z({source:new u.Z}),t,e],view:new o.ZP({center:(0,d.mi)([-46.6333,-23.5505]),zoom:4})});if(E(l),n)try{let e=new Z.Z().readFeature(n,{featureProjection:"EPSG:3857"});C.addFeature(e);let t=C.getExtent();l.getView().fit(t,{padding:[50,50,50,50],maxZoom:15})}catch(e){console.error("Failed to load initial geometry:",e)}return()=>{l.setTarget(void 0)}},[]),(0,r.useEffect)(()=>{if(z&&(F.clear(),N.length>0)){let e=new Z.Z;if(N.forEach(t=>{if(t.object)try{let n=e.readFeature(t.object,{featureProjection:"EPSG:3857"});n.set("objectId",t.id),F.addFeature(n)}catch(e){console.error("Failed to load object ".concat(t.id,":"),e)}}),F.getFeatures().length>0&&0===C.getFeatures().length){let e=F.getExtent();e[0]!==1/0&&z.getView().fit(e,{padding:[50,50,50,50],maxZoom:12})}}},[z,N,F,C]),(0,r.useEffect)(()=>{H&&H.setVisible(_)},[_,H]),(0,r.useEffect)(()=>{if(!z||(D&&(z.removeInteraction(D),I(null)),!L))return;let e=new x.ZP({source:C,type:L,style:new f.ZP({fill:new w.Z({color:"rgba(59, 130, 246, 0.3)"}),stroke:new h.Z({color:"#3b82f6",width:2,lineDash:[5,5]}),image:new g.Z({radius:5,fill:new w.Z({color:"#3b82f6"})})})});return e.on("drawstart",()=>{C.clear()}),e.on("drawend",e=>{t(new Z.Z().writeFeatureObject(e.feature,{featureProjection:"EPSG:3857"}).geometry),G(null)}),z.addInteraction(e),I(e),()=>{z.removeInteraction(e)}},[z,L,C,t]);let O=e=>{L===e?G(null):G(e)};return(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,l.jsxs)(b.z,{type:"button",size:"sm",variant:"Point"===L?"default":"outline",onClick:()=>O("Point"),title:"Draw Point",children:[(0,l.jsx)(j.Z,{className:"w-4 h-4 mr-1"}),"Point"]}),(0,l.jsxs)(b.z,{type:"button",size:"sm",variant:"LineString"===L?"default":"outline",onClick:()=>O("LineString"),title:"Draw Line",children:[(0,l.jsx)(p.Z,{className:"w-4 h-4 mr-1"}),"Line"]}),(0,l.jsxs)(b.z,{type:"button",size:"sm",variant:"Polygon"===L?"default":"outline",onClick:()=>O("Polygon"),title:"Draw Polygon",children:[(0,l.jsx)(y.Z,{className:"w-4 h-4 mr-1"}),"Polygon"]}),(0,l.jsx)("div",{className:"flex-1"}),N.length>0&&(0,l.jsxs)(b.z,{type:"button",size:"sm",variant:"outline",onClick:()=>V(!_),title:_?"Hide existing objects":"Show existing objects",children:[_?(0,l.jsx)(v.Z,{className:"w-4 h-4 mr-1"}):(0,l.jsx)(k.Z,{className:"w-4 h-4 mr-1"}),N.length," existing"]}),(0,l.jsx)(b.z,{type:"button",size:"sm",variant:"outline",onClick:()=>{C.clear(),t(null),G(null)},className:"text-destructive hover:text-destructive",title:"Clear Drawing",children:(0,l.jsx)(P.Z,{className:"w-4 h-4"})})]}),(0,l.jsx)("div",{ref:S,className:"w-full h-[60vh] min-h-[500px] rounded-lg overflow-hidden border"}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[L&&(0,l.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Point"===L&&"Click on the map to place a point","LineString"===L&&"Click to add points, double-click to finish the line","Polygon"===L&&"Click to add vertices, double-click to close the polygon"]}),N.length>0&&_&&(0,l.jsxs)("p",{className:"text-xs text-muted-foreground ml-auto",children:[(0,l.jsx)("span",{className:"inline-block w-3 h-3 rounded-full bg-gray-400 mr-1 align-middle"}),"Gray objects = existing in collection"]})]})]})}}}]);